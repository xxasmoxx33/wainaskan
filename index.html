<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙˆÙŠÙ† Ø£Ø³ÙƒÙ† - Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</title>
    <meta name="description" content="Ø£Ø¯Ø§Ø© Ø°ÙƒÙŠØ© ØªØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù…Ø§ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©. Ø­Ø¯Ø¯ Ù…ÙƒØ§Ù† Ø¹Ù…Ù„Ùƒ ÙˆØ¨ÙŠØª Ø£Ù‡Ù„Ùƒ ÙˆØ§Ø³ØªØ±Ø§Ø­ØªÙƒ ÙˆÙ†Ø­Ø³Ø¨ Ù„Ùƒ Ø£ÙØ¶Ù„ Ù…ÙˆÙ‚Ø¹!">
    <meta name="keywords" content="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†, Ø³ÙƒÙ† Ø§Ù„Ø±ÙŠØ§Ø¶, Ø£ÙØ¶Ù„ Ø­ÙŠ Ù„Ù„Ø³ÙƒÙ†, Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶, Ø´Ù‚Ù‚ Ø§Ù„Ø±ÙŠØ§Ø¶, ÙÙ„Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶, Ø¨ÙŠÙˆØª Ø§Ù„Ø±ÙŠØ§Ø¶, Ø£ÙØ¶Ù„ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ø³ÙƒÙ†">
    <meta name="author" content="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ† - Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶">
    <meta property="og:description" content="Ø£Ø¯Ø§Ø© Ø°ÙƒÙŠØ© ØªØ­Ø³Ø¨ Ù„Ùƒ Ø£ÙØ¶Ù„ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù…Ø§ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_SA">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ† - Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶">
    <meta name="twitter:description" content="Ø­Ø¯Ø¯ Ø£Ù…Ø§ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© ÙˆÙ†Ø­Ø³Ø¨ Ù„Ùƒ Ø£ÙØ¶Ù„ Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶">
    <link rel="canonical" href="https://weeenaskn.com/">
    <!-- Google Ads - Replace with your publisher ID -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --green: #10b981;
            --green-dark: #059669;
            --green-light: #6ee7b7;
            --amber: #f59e0b;
            --amber-dark: #d97706;
            --bg-dark: #0a1628;
            --bg-mid: #132a13;
            --bg-light: #1a2332;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-mid), var(--bg-light));
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* ===== NAV ===== */
        .nav {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 24px;
            background: rgba(255,255,255,0.03); backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            z-index: 1000; position: relative;
        }
        .nav-brand { display: flex; align-items: center; gap: 10px; }
        .nav-logo {
            width: 38px; height: 38px;
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;
        }
        .nav-title {
            font-size: 20px; font-weight: 800;
            background: linear-gradient(135deg, var(--green), var(--green-light));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .nav-actions { display: flex; align-items: center; gap: 8px; }
        .lang-btn {
            padding: 6px 16px; border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.6); font-family: 'Cairo', sans-serif;
            font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s;
            min-height: 44px; min-width: 44px; display: flex; align-items: center; justify-content: center;
        }
        .lang-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .lang-btn.active { background: linear-gradient(135deg, var(--green), var(--green-dark)); border-color: transparent; color: #fff; }

        /* ===== PROGRESS INDICATOR ===== */
        .progress-bar {
            display: flex; align-items: center; gap: 4px; padding: 8px 24px;
            background: rgba(255,255,255,0.02); border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .progress-step {
            flex: 1; height: 4px; border-radius: 4px;
            background: rgba(255,255,255,0.08); transition: all 0.5s ease; position: relative;
        }
        .progress-step.active { background: linear-gradient(135deg, var(--green), var(--green-light)); }
        .progress-step.active::after {
            content: attr(data-label); position: absolute; top: 8px; left: 50%; transform: translateX(-50%);
            font-size: 10px; color: var(--green-light); white-space: nowrap; font-weight: 600;
        }
        .progress-step-dot {
            width: 20px; height: 20px; border-radius: 50%; flex-shrink: 0;
            background: rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: rgba(255,255,255,0.3); transition: all 0.5s ease; font-weight: 700;
        }
        .progress-step-dot.active { background: var(--green); color: #fff; transform: scale(1.1); }

        /* ===== DESKTOP LAYOUT ===== */
        .app-layout { display: flex; height: calc(100vh - 62px - 36px); }
        [dir="rtl"] .app-layout { flex-direction: row; }

        /* ===== SIDEBAR (desktop) ===== */
        .sidebar {
            width: 400px; min-width: 400px; overflow-y: auto; padding: 24px;
            background: rgba(255,255,255,0.02);
            border-inline-start: 1px solid rgba(255,255,255,0.08);
            display: flex; flex-direction: column; gap: 20px; order: 2;
        }
        .sidebar::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-track { background: transparent; }
        .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }

        .sidebar-header h2 { font-size: 22px; font-weight: 800; margin-bottom: 6px; }
        .sidebar-header p { font-size: 13px; color: rgba(255,255,255,0.5); line-height: 1.6; }

        /* ===== SEARCH ===== */
        .search-container { position: relative; }
        .search-input {
            width: 100%; padding: 14px 48px 14px 16px;
            background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 14px; color: #fff; font-family: 'Cairo', sans-serif;
            font-size: 16px; outline: none; transition: all 0.3s;
        }
        [dir="rtl"] .search-input { padding: 14px 16px 14px 48px; }
        .search-input::placeholder { color: rgba(255,255,255,0.3); }
        .search-input:focus {
            border-color: var(--green); background: rgba(16, 185, 129, 0.08);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
        }
        .search-icon {
            position: absolute; top: 50%; transform: translateY(-50%);
            color: rgba(255,255,255,0.3); font-size: 18px; pointer-events: none;
        }
        [dir="rtl"] .search-icon { left: 16px; }
        [dir="ltr"] .search-icon { right: 16px; }
        .search-results {
            position: absolute; top: calc(100% + 6px); left: 0; right: 0;
            background: rgba(15, 25, 20, 0.98); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.12); border-radius: 14px;
            overflow: hidden; z-index: 100; display: none;
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }
        .search-results.show { display: block; }
        .search-result-item {
            padding: 12px 16px; cursor: pointer; transition: background 0.2s;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; align-items: center; gap: 10px; min-height: 44px;
        }
        .search-result-item:last-child { border-bottom: none; }
        .search-result-item:hover { background: rgba(16, 185, 129, 0.15); }
        .search-result-icon { font-size: 16px; opacity: 0.5; }
        .search-result-text {
            font-size: 13px; color: rgba(255,255,255,0.8); line-height: 1.4;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }
        .search-loading { padding: 16px; text-align: center; color: rgba(255,255,255,0.4); font-size: 13px; }

        /* ===== LOCATIONS LIST ===== */
        .locations-section-title {
            font-size: 14px; font-weight: 700; color: rgba(255,255,255,0.5);
            display: flex; align-items: center; justify-content: space-between;
        }
        .locations-count {
            background: rgba(16, 185, 129, 0.2); color: var(--green-light);
            padding: 2px 10px; border-radius: 50px; font-size: 12px; font-weight: 600;
        }
        .locations-list { display: flex; flex-direction: column; gap: 10px; min-height: 60px; }

        /* ===== EMPTY STATE ===== */
        .empty-state { text-align: center; padding: 30px 16px; color: rgba(255,255,255,0.3); }
        .empty-state-icon { font-size: 40px; margin-bottom: 12px; }
        .empty-state-animated { animation: emptyFloat 3s ease-in-out infinite; }
        @keyframes emptyFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }
        .empty-state p { font-size: 13px; line-height: 1.6; }
        .empty-state-dots { display: flex; justify-content: center; gap: 6px; margin-top: 12px; }
        .empty-state-dots span {
            width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,0.15);
            animation: dotPulse 1.5s ease-in-out infinite;
        }
        .empty-state-dots span:nth-child(2) { animation-delay: 0.2s; }
        .empty-state-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dotPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* ===== LOCATION CARD ===== */
        .location-card {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px; padding: 14px; display: flex; align-items: center; gap: 12px;
            animation: slideIn 0.3s ease; transition: all 0.3s; cursor: pointer;
        }
        .location-card:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.15); }
        .location-card:active { transform: scale(0.98); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .location-card-icon {
            width: 42px; height: 42px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;
        }
        .location-card-info { flex: 1; min-width: 0; }
        .location-card-name { font-size: 14px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .location-card-meta { display: flex; align-items: center; gap: 8px; margin-top: 3px; }
        .location-card-freq { font-size: 10px; padding: 2px 8px; border-radius: 50px; font-weight: 600; }
        .location-card-delete {
            width: 44px; height: 44px; border-radius: 10px; border: none;
            background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.3);
            font-size: 16px; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .location-card-delete:hover { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }

        /* ===== ADD FORM ===== */
        .add-form {
            background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 20px; display: none; animation: fadeIn 0.3s ease;
        }
        .add-form.show { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .add-form-title { font-size: 15px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; }
        .add-form-close {
            width: 44px; height: 44px; border-radius: 8px; border: none;
            background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.5);
            font-size: 14px; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .add-form-close:hover { background: rgba(255,255,255,0.15); color: #fff; }
        .form-group { margin-bottom: 16px; }
        .form-label { font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.5); margin-bottom: 8px; display: block; }
        .form-input {
            width: 100%; padding: 12px 14px;
            background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; color: #fff; font-family: 'Cairo', sans-serif;
            font-size: 16px; outline: none; transition: all 0.3s;
        }
        .form-input:focus { border-color: var(--green); background: rgba(16, 185, 129, 0.08); }
        .form-input.readonly-subtle { color: rgba(255,255,255,0.45); font-size: 14px; }

        /* ===== QUICK NAMES ===== */
        .quick-names { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .quick-name {
            padding: 5px 12px; border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.04);
            color: rgba(255,255,255,0.55); font-family: 'Cairo', sans-serif;
            font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; gap: 4px; min-height: 44px;
        }
        .quick-name:hover { background: rgba(16, 185, 129, 0.12); border-color: rgba(16, 185, 129, 0.3); color: var(--green-light); }

        /* ===== CHIPS ===== */
        .chips-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip {
            padding: 10px 16px; border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04);
            color: rgba(255,255,255,0.6); font-family: 'Cairo', sans-serif;
            font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; gap: 6px; min-height: 44px;
        }
        .chip:hover { background: rgba(255,255,255,0.08); color: #fff; }
        .chip.selected { background: rgba(16, 185, 129, 0.2); border-color: var(--green); color: var(--green-light); }
        .chip:active { transform: scale(0.95); }

        /* ===== BUTTONS ===== */
        .btn-primary {
            width: 100%; padding: 16px;
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            border: none; border-radius: 14px; color: #fff; font-family: 'Cairo', sans-serif;
            font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            min-height: 52px; position: relative; overflow: hidden;
        }
        .btn-primary::after {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
            opacity: 0; transition: opacity 0.3s;
        }
        .btn-primary:active::after { opacity: 1; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4); }
        .btn-primary:active { transform: translateY(0) scale(0.98); }
        .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-primary.loading { pointer-events: none; }

        .btn-secondary {
            width: 100%; padding: 12px;
            background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; color: rgba(255,255,255,0.7); font-family: 'Cairo', sans-serif;
            font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; min-height: 44px;
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-secondary:active { transform: scale(0.97); }

        .btn-add {
            padding: 14px; background: linear-gradient(135deg, var(--green), var(--green-dark));
            border: none; border-radius: 12px; color: #fff; font-family: 'Cairo', sans-serif;
            font-size: 14px; font-weight: 700; cursor: pointer; width: 100%; transition: all 0.3s;
            min-height: 48px;
        }
        .btn-add:hover { box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        .btn-add:active { transform: scale(0.97); }

        /* ===== RESULT CARD ===== */
        .result-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.12), rgba(5, 150, 105, 0.08));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 18px; padding: 24px; display: none; animation: resultReveal 0.5s ease;
        }
        .result-card.show { display: block; }
        @keyframes resultReveal { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .result-badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(16, 185, 129, 0.25); color: var(--green-light);
            padding: 4px 14px; border-radius: 50px; font-size: 11px; font-weight: 700; margin-bottom: 14px;
        }
        .result-neighborhood { font-size: 22px; font-weight: 800; margin-bottom: 8px; line-height: 1.4; }
        .result-desc { font-size: 13px; color: rgba(255,255,255,0.5); line-height: 1.6; margin-bottom: 18px; }

        /* ===== JUSTIFICATION ===== */
        .result-justification {
            background: rgba(16, 185, 129, 0.08); border: 1px solid rgba(16, 185, 129, 0.15);
            border-radius: 12px; padding: 14px; margin-bottom: 18px;
        }
        .justification-title { font-size: 12px; font-weight: 700; color: var(--green-light); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
        .justification-text { font-size: 12px; color: rgba(255,255,255,0.6); line-height: 1.7; }
        .justification-point { display: flex; align-items: flex-start; gap: 6px; margin-bottom: 4px; }
        .justification-point span:first-child { color: var(--green); flex-shrink: 0; }

        /* ===== DISTANCES ===== */
        .result-distances { display: flex; flex-direction: column; gap: 8px; margin-bottom: 18px; }
        .result-distance-item { background: rgba(255,255,255,0.04); border-radius: 12px; padding: 12px 14px; font-size: 13px; }
        .result-distance-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; }
        .result-distance-name { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; font-weight: 700; }
        .result-distance-name span:last-child { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .result-distance-km { font-weight: 700; color: var(--green-light); direction: ltr; font-size: 13px; flex-shrink: 0; }
        .result-distance-times { display: flex; gap: 8px; flex-wrap: wrap; }
        .result-time-badge { display: inline-flex; align-items: center; gap: 4px; font-size: 11px; font-weight: 600; padding: 3px 10px; border-radius: 8px; direction: ltr; }
        .result-time-normal { background: rgba(16, 185, 129, 0.12); color: var(--green-light); }
        .result-time-rush { background: rgba(239, 68, 68, 0.12); color: #fca5a5; }
        .result-actions { display: flex; gap: 8px; }
        .result-actions button { flex: 1; }

        /* ===== AD SLOTS ===== */
        .ad-slot {
            border: 1px dashed rgba(255,255,255,0.1); border-radius: 14px;
            padding: 16px; text-align: center; min-height: 100px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.02); position: relative;
        }
        .ad-slot-label {
            position: absolute; top: 8px; right: 8px;
            font-size: 10px; color: rgba(255,255,255,0.2); font-weight: 600;
        }
        [dir="ltr"] .ad-slot-label { right: auto; left: 8px; }

        /* ===== MAP ===== */
        .map-container { flex: 1; position: relative; order: 1; }
        #map { width: 100%; height: 100%; z-index: 1; cursor: crosshair; }
        .map-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(10, 22, 40, 0.85); backdrop-filter: blur(10px);
            padding: 24px 36px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center; z-index: 500; pointer-events: none; transition: opacity 0.5s;
        }
        .map-overlay.hidden { opacity: 0; }
        .map-overlay-icon { font-size: 36px; margin-bottom: 8px; animation: bounce 2s ease-in-out infinite; }
        .map-overlay p { font-size: 14px; color: rgba(255,255,255,0.7); font-weight: 600; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* ===== QUICK ADD (mobile) ===== */
        .quick-add-bar {
            display: none; position: absolute; bottom: 12px; left: 12px; right: 12px;
            z-index: 500; overflow-x: auto; -webkit-overflow-scrolling: touch;
            scrollbar-width: none; gap: 8px; padding: 4px;
        }
        .quick-add-bar::-webkit-scrollbar { display: none; }
        .quick-add-btn {
            flex-shrink: 0; padding: 8px 16px; border-radius: 50px;
            background: rgba(10, 22, 40, 0.9); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.15); color: #fff;
            font-family: 'Cairo', sans-serif; font-size: 13px; font-weight: 600;
            cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 6px;
            white-space: nowrap; min-height: 44px;
        }
        .quick-add-btn:active { transform: scale(0.95); background: rgba(16, 185, 129, 0.3); }

        /* ===== CUSTOM MARKERS ===== */
        .custom-marker { background: none; border: none; }
        .marker-pin {
            width: 42px; height: 42px; border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg); display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 0 20px rgba(16,185,129,0.15);
            border: 3px solid rgba(255,255,255,0.9); animation: markerDrop 0.4s ease-out;
        }
        .marker-pin .marker-icon { transform: rotate(45deg); font-size: 18px; line-height: 1; }
        @keyframes markerDrop {
            0% { transform: rotate(-45deg) translateY(-30px); opacity: 0; }
            60% { transform: rotate(-45deg) translateY(3px); }
            100% { transform: rotate(-45deg) translateY(0); opacity: 1; }
        }
        .marker-info-label {
            background: rgba(10, 22, 15, 0.92); backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.12); border-radius: 10px;
            padding: 5px 10px; font-family: 'Cairo', sans-serif; font-size: 11px;
            font-weight: 700; white-space: nowrap; text-align: center;
            line-height: 1.5; color: #fff; min-width: 80px;
        }
        .marker-info-km { color: var(--green-light); }
        .marker-info-time { color: rgba(255,255,255,0.5); font-size: 10px; }
        .marker-info-rush { color: #fca5a5; font-size: 10px; }
        .centroid-marker-inner {
            width: 22px; height: 22px;
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            border: 3px solid #fff; border-radius: 50%;
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4), 0 4px 15px rgba(0,0,0,0.3);
            animation: centroidPulse 2s infinite;
        }
        @keyframes centroidPulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.6), 0 4px 15px rgba(0,0,0,0.3); }
            70% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0), 0 4px 15px rgba(0,0,0,0.3); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0), 0 4px 15px rgba(0,0,0,0.3); }
        }

        /* ===== LEAFLET OVERRIDES ===== */
        .leaflet-popup-content-wrapper {
            background: rgba(15, 25, 20, 0.95); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.12); border-radius: 14px;
            color: #fff; font-family: 'Cairo', sans-serif; box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }
        .leaflet-popup-tip { background: rgba(15, 25, 20, 0.95); border: 1px solid rgba(255,255,255,0.12); }
        .leaflet-popup-content { margin: 14px 16px; font-size: 13px; line-height: 1.6; }
        .popup-title { font-weight: 700; font-size: 14px; margin-bottom: 4px; }
        .popup-info { color: rgba(255,255,255,0.5); font-size: 12px; }
        .popup-remove {
            color: #e74c3c; cursor: pointer; font-size: 12px; font-weight: 600;
            margin-top: 6px; display: inline-block; font-family: 'Cairo', sans-serif;
            background: none; border: none; padding: 4px 0; min-height: 44px;
        }
        .popup-remove:hover { text-decoration: underline; }
        .leaflet-control-zoom a {
            background: rgba(15, 25, 20, 0.9) !important; color: #fff !important;
            border-color: rgba(255,255,255,0.1) !important; backdrop-filter: blur(10px);
        }
        .leaflet-control-zoom a:hover { background: rgba(16, 185, 129, 0.3) !important; }
        .leaflet-control-attribution { background: rgba(15, 25, 20, 0.7) !important; color: rgba(255,255,255,0.4) !important; font-size: 10px !important; }
        .leaflet-control-attribution a { color: rgba(255,255,255,0.5) !important; }

        /* ===== TOAST ===== */
        .toast {
            position: fixed; top: 24px; left: 50%; transform: translateX(-50%) translateY(-20px);
            background: rgba(10, 22, 15, 0.95); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 12px 24px;
            border-radius: 14px; font-family: 'Cairo', sans-serif; font-size: 13px; font-weight: 600;
            opacity: 0; transition: all 0.3s ease; z-index: 3000; pointer-events: none;
            display: flex; align-items: center; gap: 8px;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* ===== HOW IT WORKS ===== */
        .how-it-works {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
            border-radius: 14px; padding: 16px;
        }
        .how-it-works-title { font-size: 13px; font-weight: 700; color: rgba(255,255,255,0.5); margin-bottom: 12px; }
        .how-step { display: flex; align-items: flex-start; gap: 10px; padding: 8px 0; }
        .how-step-num {
            width: 24px; height: 24px; background: rgba(16, 185, 129, 0.2);
            color: var(--green-light); border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: 800; flex-shrink: 0;
        }
        .how-step-text { font-size: 12px; color: rgba(255,255,255,0.5); line-height: 1.5; }

        /* ===== BROKER SECTION ===== */
        .broker-section { display: none; animation: resultReveal 0.5s ease; }
        .broker-section.show { display: block; }
        .broker-cta {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.12), rgba(217, 119, 6, 0.08));
            border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 18px;
            padding: 24px; text-align: center; margin-bottom: 16px;
        }
        .broker-cta-icon { font-size: 40px; margin-bottom: 10px; }
        .broker-cta-title { font-size: 17px; font-weight: 800; margin-bottom: 6px; }
        .broker-cta-desc { font-size: 12px; color: rgba(255,255,255,0.5); line-height: 1.6; margin-bottom: 16px; }
        .broker-form { display: none; animation: fadeIn 0.3s ease; }
        .broker-form.show { display: block; }
        .broker-form-card {
            background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 20px;
        }
        .broker-form-title { font-size: 15px; font-weight: 700; margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
        .broker-step-label {
            font-size: 11px; font-weight: 700; color: var(--amber);
            background: rgba(245, 158, 11, 0.15); padding: 2px 10px; border-radius: 50px;
        }
        .property-types { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .property-type-btn {
            padding: 12px 8px; background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
            color: rgba(255,255,255,0.6); font-family: 'Cairo', sans-serif;
            font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s;
            display: flex; flex-direction: column; align-items: center; gap: 4px; min-height: 64px;
        }
        .property-type-btn:hover { background: rgba(255,255,255,0.08); color: #fff; }
        .property-type-btn.selected { background: rgba(245, 158, 11, 0.15); border-color: var(--amber); color: #fbbf24; }
        .property-type-btn:active { transform: scale(0.95); }
        .property-type-icon { font-size: 22px; }
        .phone-input-wrapper { display: flex; align-items: center; gap: 8px; }
        .phone-prefix {
            padding: 12px 14px; background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
            color: rgba(255,255,255,0.6); font-family: 'Cairo', sans-serif;
            font-size: 16px; font-weight: 700; direction: ltr; flex-shrink: 0;
        }
        .phone-input {
            flex: 1; padding: 12px 14px; background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
            color: #fff; font-family: 'Cairo', sans-serif; font-size: 16px;
            outline: none; transition: all 0.3s; direction: ltr; text-align: left;
        }
        .phone-input:focus { border-color: var(--amber); background: rgba(245, 158, 11, 0.08); }
        .phone-input::placeholder { color: rgba(255,255,255,0.3); text-align: right; }
        [dir="ltr"] .phone-input::placeholder { text-align: left; }
        .btn-broker {
            width: 100%; padding: 16px; background: linear-gradient(135deg, var(--amber), var(--amber-dark));
            border: none; border-radius: 14px; color: #fff; font-family: 'Cairo', sans-serif;
            font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 8px; min-height: 52px;
        }
        .btn-broker:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4); }
        .btn-broker:active { transform: translateY(0) scale(0.98); }
        .btn-broker:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-broker-outline {
            width: 100%; padding: 14px; background: transparent;
            border: 2px solid rgba(245, 158, 11, 0.4); border-radius: 14px;
            color: var(--amber); font-family: 'Cairo', sans-serif;
            font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 8px; min-height: 52px;
        }
        .btn-broker-outline:hover { background: rgba(245, 158, 11, 0.1); border-color: var(--amber); }
        .btn-broker-outline:active { transform: scale(0.97); }
        .broker-success { display: none; text-align: center; padding: 30px 20px; animation: resultReveal 0.5s ease; }
        .broker-success.show { display: block; }
        .broker-success-icon { font-size: 50px; margin-bottom: 12px; }
        .broker-success-title { font-size: 18px; font-weight: 800; margin-bottom: 8px; color: var(--green); }
        .broker-success-desc { font-size: 13px; color: rgba(255,255,255,0.5); line-height: 1.7; }

        /* ===== CONFETTI ===== */
        .confetti-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 2500; overflow: hidden;
        }
        .confetti-piece {
            position: absolute; width: 10px; height: 10px;
            top: -10px; opacity: 0;
            animation: confettiFall 3s ease-in forwards;
        }
        @keyframes confettiFall {
            0% { opacity: 1; transform: translateY(0) rotate(0deg) scale(1); }
            100% { opacity: 0; transform: translateY(100vh) rotate(720deg) scale(0.5); }
        }

        /* ===== MOBILE BOTTOM SHEET ===== */
        .mobile-bottom-sheet {
            display: none; position: fixed; bottom: 0; left: 0; right: 0;
            z-index: 1000; background: linear-gradient(180deg, #0f1923 0%, #0a1628 100%);
            border-radius: 20px 20px 0 0; box-shadow: 0 -4px 30px rgba(0,0,0,0.5);
            transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
            max-height: calc(100vh - 40vh + 20px);
            padding-bottom: var(--safe-bottom);
        }
        .sheet-drag-handle {
            width: 100%; padding: 12px 0 8px; display: flex; justify-content: center; cursor: grab;
        }
        .sheet-drag-handle-bar {
            width: 40px; height: 5px; border-radius: 3px; background: rgba(255,255,255,0.2);
        }
        .sheet-summary {
            display: flex; align-items: center; justify-content: space-between;
            padding: 4px 20px 12px; border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .sheet-summary-info { display: flex; align-items: center; gap: 8px; }
        .sheet-summary-count {
            font-size: 13px; font-weight: 700; color: rgba(255,255,255,0.7);
        }
        .sheet-summary-btn {
            padding: 10px 20px; border-radius: 50px;
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            border: none; color: #fff; font-family: 'Cairo', sans-serif;
            font-size: 13px; font-weight: 700; cursor: pointer; min-height: 44px;
            transition: all 0.3s;
        }
        .sheet-summary-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .sheet-summary-btn:active { transform: scale(0.95); }
        .sheet-content {
            overflow-y: auto; padding: 16px 20px;
            max-height: calc(100vh - 40vh - 80px);
            -webkit-overflow-scrolling: touch;
        }
        .sheet-content::-webkit-scrollbar { width: 3px; }
        .sheet-content::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
        .sheet-content > * + * { margin-top: 16px; }

        /* ===== MOBILE RESPONSIVE ===== */
        @media (max-width: 767px) {
            body { overflow: hidden; }
            .nav { padding: 10px 16px; }
            .nav-title { font-size: 16px; }
            .progress-bar { padding: 6px 16px; }
            .progress-step.active::after { font-size: 9px; }

            .app-layout { flex-direction: column; height: calc(100vh - 54px - 30px); }
            [dir="rtl"] .app-layout { flex-direction: column; }

            .sidebar { display: none; }

            .map-container {
                height: 40vh; min-height: 200px; order: 1;
                position: relative; flex: none;
            }

            .quick-add-bar { display: flex; }

            .mobile-bottom-sheet { display: block; }
            .mobile-bottom-sheet.collapsed { transform: translateY(calc(100% - 90px)); }
            .mobile-bottom-sheet.expanded { transform: translateY(0); }

            .map-overlay { padding: 16px 24px; }
            .map-overlay-icon { font-size: 28px; }
            .map-overlay p { font-size: 12px; }

            .chips-container { gap: 6px; }
            .chip { flex: 1; justify-content: center; min-width: calc(50% - 4px); }

            .toast { top: 12px; font-size: 12px; padding: 10px 18px; max-width: 90vw; }
        }

        @media (min-width: 768px) {
            .mobile-bottom-sheet { display: none !important; }
            .quick-add-bar { display: none !important; }
            .sidebar { display: flex !important; }
        }

        @media (max-width: 480px) {
            .property-types { grid-template-columns: repeat(3, 1fr); gap: 6px; }
            .property-type-btn { padding: 10px 6px; font-size: 11px; }
        }

        /* ===== SKELETON LOADING ===== */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.04) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.04) 75%);
            background-size: 200% 100%; animation: shimmer 1.5s ease-in-out infinite; border-radius: 8px;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>

    <!-- NAV -->
    <nav class="nav">
        <div class="nav-brand">
            <div class="nav-logo">ğŸ </div>
            <span class="nav-title" data-ar="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†" data-en="Where to Live">ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†</span>
        </div>
        <div class="nav-actions">
            <button class="lang-btn active" onclick="setLang('ar')">Ø¹Ø±Ø¨ÙŠ</button>
            <button class="lang-btn" onclick="setLang('en')">EN</button>
        </div>
    </nav>

    <!-- PROGRESS BAR -->
    <div class="progress-bar" id="progressBar">
        <div class="progress-step-dot" id="progDot1">1</div>
        <div class="progress-step" id="progStep1" data-label=""></div>
        <div class="progress-step-dot" id="progDot2">2</div>
        <div class="progress-step" id="progStep2" data-label=""></div>
        <div class="progress-step-dot" id="progDot3">3</div>
    </div>

    <!-- APP LAYOUT -->
    <div class="app-layout">

        <!-- MAP -->
        <div class="map-container">
            <div id="map"></div>
            <div class="map-overlay" id="mapOverlay">
                <div class="map-overlay-icon">ğŸ“</div>
                <p data-ar="Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹" data-en="Click on the map to add a location">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹</p>
            </div>
            <!-- Quick Add Bar (mobile) -->
            <div class="quick-add-bar" id="quickAddBar">
                <button class="quick-add-btn" onclick="quickSearch('Ø§Ù„Ø¹Ù…Ù„','Work')">ğŸ’¼ <span data-ar="Ø§Ù„Ø¹Ù…Ù„" data-en="Work">Ø§Ù„Ø¹Ù…Ù„</span></button>
                <button class="quick-add-btn" onclick="quickSearch('Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„','Family Home')">ğŸ¡ <span data-ar="Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„" data-en="Family Home">Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„</span></button>
                <button class="quick-add-btn" onclick="quickSearch('Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©','Rest House')">ğŸŒ´ <span data-ar="Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©" data-en="Rest House">Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©</span></button>
                <button class="quick-add-btn" onclick="quickSearch('Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©','University')">ğŸ“ <span data-ar="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" data-en="University">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</span></button>
            </div>
        </div>

        <!-- SIDEBAR (desktop only) -->
        <div class="sidebar" id="desktopSidebar">

            <!-- HEADER -->
            <div class="sidebar-header">
                <h2 data-ar="Ø§ÙƒØªØ´Ù Ù…Ù†Ø·Ù‚ØªÙƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©" data-en="Find Your Optimal Area">Ø§ÙƒØªØ´Ù Ù…Ù†Ø·Ù‚ØªÙƒ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©</h2>
                <p data-ar="Ø­Ø¯Ø¯ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù„ÙŠ ØªØ²ÙˆØ±Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø± ÙˆØ±Ø§Ø­ Ù†Ø­Ø³Ø¨ Ù„Ùƒ Ø£ÙØ¶Ù„ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶" data-en="Mark the places you frequently visit and we'll calculate the best area for you to live in Riyadh">Ø­Ø¯Ø¯ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù„ÙŠ ØªØ²ÙˆØ±Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø± ÙˆØ±Ø§Ø­ Ù†Ø­Ø³Ø¨ Ù„Ùƒ Ø£ÙØ¶Ù„ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„Ø³ÙƒÙ† ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</p>
            </div>

            <!-- SEARCH -->
            <div class="search-container" id="desktopSearchContainer">
                <input type="text" class="search-input" id="searchInput"
                    placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶..."
                    data-ar-ph="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶..."
                    data-en-ph="Search for a location in Riyadh..."
                    autocomplete="off">
                <span class="search-icon">ğŸ”</span>
                <div class="search-results" id="searchResults"></div>
            </div>

            <!-- LOCATIONS LIST -->
            <div>
                <div class="locations-section-title">
                    <span data-ar="Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©" data-en="Selected Locations">Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
                    <span class="locations-count" id="locationsCount">0</span>
                </div>
                <div class="locations-list" id="locationsList">
                    <div class="empty-state" id="emptyState">
                        <div class="empty-state-icon empty-state-animated">ğŸ“</div>
                        <p data-ar="Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ù…Ø§ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©" data-en="Search or click on the map to add your frequent places">Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ù…Ø§ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©</p>
                        <div class="empty-state-dots"><span></span><span></span><span></span></div>
                    </div>
                </div>
            </div>

            <!-- ADD LOCATION FORM -->
            <div class="add-form" id="addForm">
                <div class="add-form-title">
                    <span data-ar="Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹" data-en="Add Location">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹</span>
                    <button class="add-form-close" onclick="closeAddForm()">âœ•</button>
                </div>
                <div class="form-group">
                    <label class="form-label" data-ar="ğŸ“ Ø§Ù„Ø­ÙŠ" data-en="ğŸ“ Neighborhood">ğŸ“ Ø§Ù„Ø­ÙŠ</label>
                    <input type="text" class="form-input readonly-subtle" id="locationNeighborhood" readonly
                        placeholder="ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§..."
                        data-ar-ph="ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§..."
                        data-en-ph="Detected automatically...">
                </div>
                <div class="form-group">
                    <label class="form-label" data-ar="âœï¸ Ø³Ù…Ù‘ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù†" data-en="âœï¸ Name this place">âœï¸ Ø³Ù…Ù‘ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù†</label>
                    <input type="text" class="form-input" id="locationName"
                        placeholder="Ù…Ø«Ø§Ù„: Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„ØŒ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ Ø§Ù„Ù…ÙƒØªØ¨..."
                        data-ar-ph="Ù…Ø«Ø§Ù„: Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„ØŒ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ Ø§Ù„Ù…ÙƒØªØ¨..."
                        data-en-ph="e.g. Family home, University, Office...">
                    <div class="quick-names" id="quickNames">
                        <button class="quick-name" onclick="setQuickName('ğŸ’¼','Ø§Ù„Ø¹Ù…Ù„','Work')"><span>ğŸ’¼</span> <span data-ar="Ø§Ù„Ø¹Ù…Ù„" data-en="Work">Ø§Ù„Ø¹Ù…Ù„</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ¡','Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„','Family Home')"><span>ğŸ¡</span> <span data-ar="Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„" data-en="Family Home">Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ ','Ø§Ù„Ù…Ù†Ø²Ù„','Home')"><span>ğŸ </span> <span data-ar="Ø§Ù„Ù…Ù†Ø²Ù„" data-en="Home">Ø§Ù„Ù…Ù†Ø²Ù„</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸŒ´','Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©','Rest House')"><span>ğŸŒ´</span> <span data-ar="Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©" data-en="Rest House">Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ“','Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©','University')"><span>ğŸ“</span> <span data-ar="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" data-en="University">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ‹ï¸','Ø§Ù„Ù†Ø§Ø¯ÙŠ','Gym')"><span>ğŸ‹ï¸</span> <span data-ar="Ø§Ù„Ù†Ø§Ø¯ÙŠ" data-en="Gym">Ø§Ù„Ù†Ø§Ø¯ÙŠ</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ¢','Ø§Ù„Ù…ÙƒØªØ¨','Office')"><span>ğŸ¢</span> <span data-ar="Ø§Ù„Ù…ÙƒØªØ¨" data-en="Office">Ø§Ù„Ù…ÙƒØªØ¨</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ›’','Ø§Ù„Ø³ÙˆÙ‚','Market')"><span>ğŸ›’</span> <span data-ar="Ø§Ù„Ø³ÙˆÙ‚" data-en="Market">Ø§Ù„Ø³ÙˆÙ‚</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ«','Ø§Ù„Ù…Ø¯Ø±Ø³Ø©','School')"><span>ğŸ«</span> <span data-ar="Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" data-en="School">Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</span></button>
                        <button class="quick-name" onclick="setQuickName('ğŸ•Œ','Ø§Ù„Ù…Ø³Ø¬Ø¯','Mosque')"><span>ğŸ•Œ</span> <span data-ar="Ø§Ù„Ù…Ø³Ø¬Ø¯" data-en="Mosque">Ø§Ù„Ù…Ø³Ø¬Ø¯</span></button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" data-ar="ğŸ”„ Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø©" data-en="ğŸ”„ Visit Frequency">ğŸ”„ Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label>
                    <div class="chips-container" id="freqChips">
                        <button class="chip selected" data-freq="daily" onclick="selectFreq(this)"><span data-ar="ÙŠÙˆÙ…ÙŠÙ‹Ø§" data-en="Daily">ÙŠÙˆÙ…ÙŠÙ‹Ø§</span></button>
                        <button class="chip" data-freq="weekly" onclick="selectFreq(this)"><span data-ar="Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§" data-en="Weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§</span></button>
                        <button class="chip" data-freq="monthly" onclick="selectFreq(this)"><span data-ar="Ø´Ù‡Ø±ÙŠÙ‹Ø§" data-en="Monthly">Ø´Ù‡Ø±ÙŠÙ‹Ø§</span></button>
                    </div>
                </div>
                <button class="btn-add" onclick="confirmAddLocation()" data-ar="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ â•" data-en="Add Location â•">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ â•</button>
            </div>

            <!-- CALCULATE BUTTON -->
            <button class="btn-primary" id="calculateBtn" onclick="calculateOptimal()" disabled>
                <span>âœ¨</span>
                <span data-ar="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ" data-en="Where should I live?">ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ</span>
            </button>

            <!-- RESULT CARD -->
            <div class="result-card" id="resultCard">
                <div class="result-badge">
                    <span>ğŸ¯</span>
                    <span data-ar="Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©" data-en="Optimal Area">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©</span>
                </div>
                <div class="result-neighborhood" id="resultNeighborhood">---</div>
                <div class="result-desc" id="resultDesc"></div>
                <div class="result-justification" id="resultJustification"></div>
                <div class="result-distances" id="resultDistances"></div>
                <div class="result-actions">
                    <button class="btn-secondary" onclick="resetAll()">
                        <span data-ar="ğŸ”„ Ù…Ù† Ø¬Ø¯ÙŠØ¯" data-en="ğŸ”„ Reset">ğŸ”„ Ù…Ù† Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                    <button class="btn-secondary" onclick="shareResult()">
                        <span data-ar="ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©" data-en="ğŸ“‹ Copy Result">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</span>
                    </button>
                </div>
            </div>

            <!-- AD SLOT 2: After result -->
            <div class="ad-slot" id="adSlot2" style="display:none;">
                <span class="ad-slot-label">Ø¥Ø¹Ù„Ø§Ù†</span>
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX" data-ad-format="auto" data-full-width-responsive="true"></ins>
            </div>

            <!-- BROKER SECTION -->
            <div class="broker-section" id="brokerSection">
                <div class="broker-cta" id="brokerCta">
                    <div class="broker-cta-icon">ğŸ¡</div>
                    <div class="broker-cta-title" data-ar="ØªØ¨ÙŠ ÙˆØ³Ø·Ø§Ø¡ Ø¹Ù‚Ø§Ø±ÙŠÙŠÙ† ÙŠØªÙˆØ§ØµÙ„ÙˆÙ† Ù…Ø¹ÙƒØŸ" data-en="Want real estate agents to contact you?">ØªØ¨ÙŠ ÙˆØ³Ø·Ø§Ø¡ Ø¹Ù‚Ø§Ø±ÙŠÙŠÙ† ÙŠØªÙˆØ§ØµÙ„ÙˆÙ† Ù…Ø¹ÙƒØŸ</div>
                    <div class="broker-cta-desc" data-ar="Ø­Ø· Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ¨ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙˆØ³Ø·Ø§Ø¡ Ø¹Ù‚Ø§Ø±ÙŠÙŠÙ† Ù…ØªØ®ØµØµÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©" data-en="Share your details and specialized agents will reach out">Ø­Ø· Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ¨ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙˆØ³Ø·Ø§Ø¡ Ø¹Ù‚Ø§Ø±ÙŠÙŠÙ† Ù…ØªØ®ØµØµÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</div>
                    <button class="btn-broker-outline" onclick="showBrokerForm()">
                        <span>ğŸ“‹</span>
                        <span data-ar="Ù†Ø¹Ù…ØŒ Ø£Ø¨ÙŠ ÙˆØ³ÙŠØ· Ø¹Ù‚Ø§Ø±ÙŠ" data-en="Yes, I want a broker">Ù†Ø¹Ù…ØŒ Ø£Ø¨ÙŠ ÙˆØ³ÙŠØ· Ø¹Ù‚Ø§Ø±ÙŠ</span>
                    </button>
                </div>

                <div class="broker-form" id="brokerForm">
                    <div class="broker-form-card">
                        <div class="broker-form-title">
                            <span>ğŸ“‹</span>
                            <span data-ar="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨" data-en="Request Details">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</span>
                        </div>
                        <!-- Q1: Property Type -->
                        <div class="form-group">
                            <label class="form-label">
                                <span class="broker-step-label" data-ar="Ù¡" data-en="1">Ù¡</span>
                                <span data-ar=" ÙˆØ´ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ØŸ" data-en=" What property type?"> ÙˆØ´ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ØŸ</span>
                            </label>
                            <div class="property-types" id="propertyTypes">
                                <button class="property-type-btn" data-type="land" onclick="selectProperty(this)"><span class="property-type-icon">ğŸ—ï¸</span><span data-ar="Ø£Ø±Ø¶" data-en="Land">Ø£Ø±Ø¶</span></button>
                                <button class="property-type-btn" data-type="villa" onclick="selectProperty(this)"><span class="property-type-icon">ğŸ¡</span><span data-ar="ÙÙŠÙ„Ø§" data-en="Villa">ÙÙŠÙ„Ø§</span></button>
                                <button class="property-type-btn" data-type="apartment" onclick="selectProperty(this)"><span class="property-type-icon">ğŸ¢</span><span data-ar="Ø´Ù‚Ø©" data-en="Apartment">Ø´Ù‚Ø©</span></button>
                                <button class="property-type-btn" data-type="duplex" onclick="selectProperty(this)"><span class="property-type-icon">ğŸ˜ï¸</span><span data-ar="Ø¯Ø¨Ù„ÙƒØ³" data-en="Duplex">Ø¯Ø¨Ù„ÙƒØ³</span></button>
                                <button class="property-type-btn" data-type="floor" onclick="selectProperty(this)"><span class="property-type-icon">ğŸ </span><span data-ar="Ø¯ÙˆØ±" data-en="Floor">Ø¯ÙˆØ±</span></button>
                                <button class="property-type-btn" data-type="townhouse" onclick="selectProperty(this)"><span class="property-type-icon">ğŸšï¸</span><span data-ar="ØªØ§ÙˆÙ† Ù‡Ø§ÙˆØ³" data-en="Townhouse">ØªØ§ÙˆÙ† Ù‡Ø§ÙˆØ³</span></button>
                            </div>
                        </div>
                        <!-- Q2: Buy or Rent -->
                        <div class="form-group">
                            <label class="form-label">
                                <span class="broker-step-label" data-ar="Ù¢" data-en="2">Ù¢</span>
                                <span data-ar=" Ø´Ø±Ø§Ø¡ Ø£Ùˆ Ø¥ÙŠØ¬Ø§Ø±ØŸ" data-en=" Buy or Rent?"> Ø´Ø±Ø§Ø¡ Ø£Ùˆ Ø¥ÙŠØ¬Ø§Ø±ØŸ</span>
                            </label>
                            <div class="chips-container" id="purposeChips">
                                <button class="chip" data-purpose="buy" onclick="selectPurpose(this)"><span>ğŸ”‘</span><span data-ar="Ø´Ø±Ø§Ø¡" data-en="Buy">Ø´Ø±Ø§Ø¡</span></button>
                                <button class="chip" data-purpose="rent" onclick="selectPurpose(this)"><span>ğŸ“</span><span data-ar="Ø¥ÙŠØ¬Ø§Ø±" data-en="Rent">Ø¥ÙŠØ¬Ø§Ø±</span></button>
                            </div>
                        </div>
                        <!-- Phone -->
                        <div class="form-group">
                            <label class="form-label">
                                <span class="broker-step-label" data-ar="Ù£" data-en="3">Ù£</span>
                                <span data-ar=" Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„ØªÙˆØ§ØµÙ„" data-en=" Your phone number"> Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ù„ØªÙˆØ§ØµÙ„</span>
                            </label>
                            <div class="phone-input-wrapper">
                                <span class="phone-prefix">+966</span>
                                <input type="tel" class="phone-input" id="brokerPhone"
                                    placeholder="5XXXXXXXX" maxlength="9"
                                    oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            </div>
                        </div>
                        <button class="btn-broker" id="brokerSubmitBtn" onclick="submitBrokerForm()" disabled>
                            <span>ğŸ“¤</span>
                            <span data-ar="Ø£Ø±Ø³Ù„ Ø·Ù„Ø¨ÙŠ Ù„Ù„ÙˆØ³Ø·Ø§Ø¡" data-en="Send to Brokers">Ø£Ø±Ø³Ù„ Ø·Ù„Ø¨ÙŠ Ù„Ù„ÙˆØ³Ø·Ø§Ø¡</span>
                        </button>
                    </div>
                </div>

                <div class="broker-success" id="brokerSuccess">
                    <div class="broker-success-icon">ğŸ‰</div>
                    <div class="broker-success-title" data-ar="ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!" data-en="Request sent successfully!">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</div>
                    <div class="broker-success-desc" data-ar="Ø±Ø§Ø­ ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙˆØ³Ø·Ø§Ø¡ Ø¹Ù‚Ø§Ø±ÙŠÙŠÙ† Ù…ØªØ®ØµØµÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ø®Ù„Ø§Ù„ 24-48 Ø³Ø§Ø¹Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†!" data-en="Specialized real estate agents will contact you within 24-48 hours. Thanks for using Where to Live!">Ø±Ø§Ø­ ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙˆØ³Ø·Ø§Ø¡ Ø¹Ù‚Ø§Ø±ÙŠÙŠÙ† Ù…ØªØ®ØµØµÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ø®Ù„Ø§Ù„ 24-48 Ø³Ø§Ø¹Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†!</div>
                </div>
            </div>

            <!-- HOW IT WORKS -->
            <div class="how-it-works" id="howItWorks">
                <div class="how-it-works-title" data-ar="ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ØŸ" data-en="How it works?">ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ØŸ</div>
                <div class="how-step">
                    <div class="how-step-num">1</div>
                    <div class="how-step-text" data-ar="Ø£Ø¶Ù Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù„ÙŠ ØªØ±ÙˆØ­ Ù„Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø± ÙˆØ³Ù…Ù‘Ù‡Ø§ Ø¨Ù†ÙØ³Ùƒ" data-en="Add places you frequently visit and name them yourself">Ø£Ø¶Ù Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù„ÙŠ ØªØ±ÙˆØ­ Ù„Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø± ÙˆØ³Ù…Ù‘Ù‡Ø§ Ø¨Ù†ÙØ³Ùƒ</div>
                </div>
                <div class="how-step">
                    <div class="how-step-num">2</div>
                    <div class="how-step-text" data-ar="Ø­Ø¯Ø¯ ÙƒÙ… Ù…Ø±Ø© ØªØ²ÙˆØ± ÙƒÙ„ Ù…ÙƒØ§Ù† (ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŒ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§ØŒ Ø´Ù‡Ø±ÙŠÙ‹Ø§)" data-en="Set how often you visit each place">Ø­Ø¯Ø¯ ÙƒÙ… Ù…Ø±Ø© ØªØ²ÙˆØ± ÙƒÙ„ Ù…ÙƒØ§Ù† (ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŒ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§ØŒ Ø´Ù‡Ø±ÙŠÙ‹Ø§)</div>
                </div>
                <div class="how-step">
                    <div class="how-step-num">3</div>
                    <div class="how-step-text" data-ar="Ø§Ø¶ØºØ· 'ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ' ÙˆØ±Ø§Ø­ Ù†Ø­Ø³Ø¨ Ù„Ùƒ Ø£ÙØ¶Ù„ Ù…ÙˆÙ‚Ø¹ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙˆÙˆÙ‚Øª Ø§Ù„Ø²Ø­Ù…Ø©" data-en="Click 'Where should I live?' and we'll calculate the best spot">Ø§Ø¶ØºØ· 'ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ' ÙˆØ±Ø§Ø­ Ù†Ø­Ø³Ø¨ Ù„Ùƒ Ø£ÙØ¶Ù„ Ù…ÙˆÙ‚Ø¹ Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙˆÙˆÙ‚Øª Ø§Ù„Ø²Ø­Ù…Ø©</div>
                </div>
            </div>

            <!-- AD SLOT 1: After how it works -->
            <div class="ad-slot" id="adSlot1">
                <span class="ad-slot-label">Ø¥Ø¹Ù„Ø§Ù†</span>
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="XXXXXXXXXX" data-ad-format="auto" data-full-width-responsive="true"></ins>
            </div>

        </div>
    </div>

    <!-- MOBILE BOTTOM SHEET -->
    <div class="mobile-bottom-sheet collapsed" id="bottomSheet">
        <div class="sheet-drag-handle" id="sheetDragHandle">
            <div class="sheet-drag-handle-bar"></div>
        </div>
        <div class="sheet-summary" id="sheetSummary">
            <div class="sheet-summary-info">
                <span id="sheetLocCount" class="sheet-summary-count" data-ar="0 Ù…ÙˆØ§Ù‚Ø¹" data-en="0 locations">0 Ù…ÙˆØ§Ù‚Ø¹</span>
            </div>
            <button class="sheet-summary-btn" id="sheetCalcBtn" onclick="calculateOptimal()" disabled>
                <span data-ar="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ âœ¨" data-en="Where to live? âœ¨">ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ âœ¨</span>
            </button>
        </div>
        <div class="sheet-content" id="sheetContent">
            <!-- Filled dynamically -->
        </div>
    </div>

    <!-- CONFETTI CONTAINER -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
    // ===== STATE =====
    let lang = 'ar';
    let locations = [];
    let pendingLocation = null;
    let isCalculated = false;
    let selectedEmoji = 'ğŸ“Œ';
    let isMobile = window.innerWidth < 768;

    let map;
    let markersGroup;
    let centroidMarker = null;
    let zoneRect = null;
    let connectionLines = [];
    let distanceLabels = [];
    let tempMarker = null;

    // ===== ICON MAP =====
    const NAME_ICONS = {
        'Ø§Ù„Ø¹Ù…Ù„': 'ğŸ’¼', 'Work': 'ğŸ’¼', 'Ø¨ÙŠØª Ø§Ù„Ø£Ù‡Ù„': 'ğŸ¡', 'Family Home': 'ğŸ¡',
        'Ø§Ù„Ù…Ù†Ø²Ù„': 'ğŸ ', 'Home': 'ğŸ ', 'Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©': 'ğŸŒ´', 'Rest House': 'ğŸŒ´',
        'Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©': 'ğŸ“', 'University': 'ğŸ“', 'Ø§Ù„Ù†Ø§Ø¯ÙŠ': 'ğŸ‹ï¸', 'Gym': 'ğŸ‹ï¸',
        'Ø§Ù„Ù…ÙƒØªØ¨': 'ğŸ¢', 'Office': 'ğŸ¢', 'Ø§Ù„Ø³ÙˆÙ‚': 'ğŸ›’', 'Market': 'ğŸ›’',
        'Ø§Ù„Ù…Ø¯Ø±Ø³Ø©': 'ğŸ«', 'School': 'ğŸ«', 'Ø§Ù„Ù…Ø³Ø¬Ø¯': 'ğŸ•Œ', 'Mosque': 'ğŸ•Œ'
    };

    const LOCATION_COLORS = ['#10b981', '#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#f97316'];
    const FREQ_WEIGHTS = { daily: 30, weekly: 4, monthly: 1 };
    const FREQ_LABELS = {
        daily:   { ar: 'ÙŠÙˆÙ…ÙŠÙ‹Ø§',    en: 'Daily' },
        weekly:  { ar: 'Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§', en: 'Weekly' },
        monthly: { ar: 'Ø´Ù‡Ø±ÙŠÙ‹Ø§',   en: 'Monthly' }
    };

    const AVG_SPEED_NORMAL = 45;
    const AVG_SPEED_RUSH   = 22;

    function estimateMinutes(distKm, speedKmh) {
        return Math.max(1, Math.round((distKm / speedKmh) * 60));
    }

    // ===== PROGRESS =====
    function updateProgress() {
        const dot1 = document.getElementById('progDot1');
        const dot2 = document.getElementById('progDot2');
        const dot3 = document.getElementById('progDot3');
        const step1 = document.getElementById('progStep1');
        const step2 = document.getElementById('progStep2');

        const hasLocs = locations.length > 0;
        const hasEnough = locations.length >= 2;

        dot1.classList.toggle('active', hasLocs);
        step1.classList.toggle('active', hasLocs);
        step1.dataset.label = hasLocs ? (lang === 'ar' ? 'Ø£Ù…Ø§ÙƒÙ† âœ“' : 'Places âœ“') : '';

        dot2.classList.toggle('active', hasEnough);
        step2.classList.toggle('active', hasEnough);
        step2.dataset.label = hasEnough ? (lang === 'ar' ? 'Ø¬Ø§Ù‡Ø² âœ“' : 'Ready âœ“') : '';

        dot3.classList.toggle('active', isCalculated);
    }

    // ===== MAP INIT =====
    function initMap() {
        map = L.map('map', {
            center: [24.7136, 46.6753], zoom: 11,
            zoomControl: true, attributionControl: true,
            dragging: true, touchZoom: true, scrollWheelZoom: true,
            doubleClickZoom: false, boxZoom: true, keyboard: true
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap', maxZoom: 19
        }).addTo(map);

        markersGroup = L.layerGroup().addTo(map);

        map.on('click', function(e) { onMapClick(e.latlng.lat, e.latlng.lng); });

        setTimeout(() => map.invalidateSize(), 100);
        window.addEventListener('resize', () => {
            isMobile = window.innerWidth < 768;
            setTimeout(() => map.invalidateSize(), 200);
        });
    }

    // ===== MAP CLICK =====
    function onMapClick(lat, lng) {
        if (isCalculated) return;
        if (tempMarker) { map.removeLayer(tempMarker); tempMarker = null; }

        tempMarker = L.circleMarker([lat, lng], {
            radius: 10, color: '#10b981', fillColor: '#10b981', fillOpacity: 0.4, weight: 2
        }).addTo(map);

        document.getElementById('mapOverlay').classList.add('hidden');
        pendingLocation = { lat, lng };

        const nbField = document.getElementById('locationNeighborhood');
        nbField.value = lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...' : 'Detecting...';
        reverseGeocode(lat, lng).then(name => { nbField.value = name; });

        document.getElementById('locationName').value = '';
        selectedEmoji = 'ğŸ“Œ';
        resetFormSelections();

        if (isMobile) {
            expandSheet();
            renderMobileSheetWithForm();
        } else {
            document.getElementById('addForm').classList.add('show');
            document.getElementById('addForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            setTimeout(() => document.getElementById('locationName').focus(), 300);
        }
    }

    // ===== SEARCH =====
    let searchTimeout = null;

    function setupSearch(inputEl, resultsEl) {
        inputEl.addEventListener('input', function() {
            const query = this.value.trim();
            if (query.length < 2) { resultsEl.classList.remove('show'); return; }
            clearTimeout(searchTimeout);
            resultsEl.innerHTML = '<div class="search-loading">' + (lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...' : 'Searching...') + '</div>';
            resultsEl.classList.add('show');
            searchTimeout = setTimeout(() => searchNominatim(query, resultsEl), 400);
        });
        inputEl.addEventListener('focus', function() {
            if (this.value.trim().length >= 2) resultsEl.classList.add('show');
        });
    }

    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) {
            document.querySelectorAll('.search-results').forEach(r => r.classList.remove('show'));
        }
    });

    async function searchNominatim(query, resultsEl) {
        try {
            const url = 'https://nominatim.openstreetmap.org/search?q=' + encodeURIComponent(query + ' Ø§Ù„Ø±ÙŠØ§Ø¶') + '&format=json&addressdetails=1&limit=5&viewbox=46.2,25.1,47.2,24.3&bounded=1&accept-language=' + lang;
            const res = await fetch(url, { headers: { 'User-Agent': 'WainAskan-App/1.0' } });
            const data = await res.json();

            if (data.length === 0) {
                resultsEl.innerHTML = '<div class="search-loading">' + (lang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬' : 'No results found') + '</div>';
                return;
            }

            resultsEl.innerHTML = data.map(item =>
                '<div class="search-result-item" onclick="selectSearchResult(' + item.lat + ', ' + item.lon + ', \'' + escapeHtml(item.display_name) + '\')">' +
                '<span class="search-result-icon">ğŸ“</span>' +
                '<span class="search-result-text">' + item.display_name + '</span></div>'
            ).join('');
        } catch (err) {
            resultsEl.innerHTML = '<div class="search-loading">' + (lang === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«' : 'Search error') + '</div>';
        }
    }

    function selectSearchResult(lat, lng, name) {
        document.querySelectorAll('.search-results').forEach(r => r.classList.remove('show'));
        document.querySelectorAll('.search-input').forEach(i => { i.value = ''; });
        map.flyTo([lat, lng], 14, { duration: 1 });
        setTimeout(() => onMapClick(lat, lng), 300);
    }

    // ===== QUICK SEARCH (mobile) =====
    function quickSearch(arName, enName) {
        const query = lang === 'ar' ? arName : enName;
        if (isMobile) {
            expandSheet();
            renderMobileSheetSearch(query);
        }
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.value = query;
            searchInput.dispatchEvent(new Event('input'));
        }
    }

    // ===== REVERSE GEOCODE =====
    let lastGeocodeTime = 0;

    async function reverseGeocode(lat, lng) {
        const now = Date.now();
        const wait = Math.max(0, 1100 - (now - lastGeocodeTime));
        if (wait > 0) await new Promise(r => setTimeout(r, wait));
        lastGeocodeTime = Date.now();

        try {
            const url = 'https://nominatim.openstreetmap.org/reverse?lat=' + lat + '&lon=' + lng + '&format=json&addressdetails=1&accept-language=' + lang;
            const res = await fetch(url, { headers: { 'User-Agent': 'WainAskan-App/1.0' } });
            const data = await res.json();
            if (data.address) {
                return data.address.suburb || data.address.neighbourhood || data.address.city_district || data.address.road || data.display_name.split(',')[0];
            }
            return lang === 'ar' ? 'Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯' : 'Selected Location';
        } catch {
            return lang === 'ar' ? 'Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯' : 'Selected Location';
        }
    }

    // ===== FORM CONTROLS =====
    let selectedFreq = 'daily';

    function setQuickName(emoji, arName, enName) {
        document.getElementById('locationName').value = lang === 'ar' ? arName : enName;
        selectedEmoji = emoji;
    }

    function selectFreq(el) {
        const container = el.closest('.chips-container') || document.getElementById('freqChips');
        container.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        selectedFreq = el.dataset.freq;
    }

    function resetFormSelections() {
        selectedFreq = 'daily'; selectedEmoji = 'ğŸ“Œ';
        document.querySelectorAll('#freqChips .chip').forEach(c => c.classList.remove('selected'));
        const dailyChip = document.querySelector('#freqChips .chip[data-freq="daily"]');
        if (dailyChip) dailyChip.classList.add('selected');
    }

    function closeAddForm() {
        document.getElementById('addForm').classList.remove('show');
        if (tempMarker) { map.removeLayer(tempMarker); tempMarker = null; }
        pendingLocation = null;
        if (isMobile) { renderMobileSheet(); collapseSheet(); }
    }

    function getIconForName(name) {
        if (NAME_ICONS[name]) return NAME_ICONS[name];
        if (selectedEmoji !== 'ğŸ“Œ') return selectedEmoji;
        for (const [key, icon] of Object.entries(NAME_ICONS)) {
            if (name.includes(key) || key.includes(name)) return icon;
        }
        return 'ğŸ“Œ';
    }

    // ===== ADD LOCATION =====
    function confirmAddLocation() {
        if (!pendingLocation) return;

        const name = document.getElementById('locationName').value.trim() || (lang === 'ar' ? 'Ù…ÙˆÙ‚Ø¹ Ù…Ø®ØµØµ' : 'Custom Location');
        const neighborhood = document.getElementById('locationNeighborhood').value.trim();
        const icon = getIconForName(name);
        const colorIdx = locations.length % LOCATION_COLORS.length;
        const color = LOCATION_COLORS[colorIdx];

        const location = {
            id: 'loc_' + Date.now(), name: name, neighborhood: neighborhood,
            icon: icon, lat: pendingLocation.lat, lng: pendingLocation.lng,
            frequency: selectedFreq, color: color, marker: null
        };

        const markerIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div class="marker-pin" style="background: ' + color + '"><span class="marker-icon">' + icon + '</span></div>',
            iconSize: [42, 48], iconAnchor: [21, 48], popupAnchor: [0, -48]
        });

        const marker = L.marker([location.lat, location.lng], { icon: markerIcon }).addTo(markersGroup);
        marker.bindPopup(createPopupContent(location));
        location.marker = marker;

        if (tempMarker) { map.removeLayer(tempMarker); tempMarker = null; }

        locations.push(location);
        renderLocationsList();
        closeAddForm();
        updateCalculateButton();
        updateProgress();

        showToast(lang === 'ar' ? 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "' + name + '"' : '"' + name + '" added');
    }

    function createPopupContent(loc) {
        const freqLabel = lang === 'ar' ? FREQ_LABELS[loc.frequency].ar : FREQ_LABELS[loc.frequency].en;
        return '<div class="popup-title">' + loc.icon + ' ' + loc.name + '</div>' +
            '<div class="popup-info">' + loc.neighborhood + ' Â· ' + freqLabel + '</div>' +
            '<button class="popup-remove" onclick="removeLocation(\'' + loc.id + '\')">' + (lang === 'ar' ? 'ğŸ—‘ï¸ Ø­Ø°Ù' : 'ğŸ—‘ï¸ Remove') + '</button>';
    }

    function removeLocation(id) {
        const idx = locations.findIndex(l => l.id === id);
        if (idx === -1) return;
        const loc = locations[idx];
        if (loc.marker) markersGroup.removeLayer(loc.marker);
        locations.splice(idx, 1);
        map.closePopup();
        renderLocationsList();
        updateCalculateButton();
        updateProgress();
        if (isCalculated) clearResult();
        showToast(lang === 'ar' ? 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆÙ‚Ø¹' : 'Location removed');
    }

    // ===== RENDER LOCATIONS =====
    function renderLocationsList() {
        // Desktop
        const listEl = document.getElementById('locationsList');
        const countEl = document.getElementById('locationsCount');
        countEl.textContent = locations.length;

        if (locations.length === 0) {
            listEl.innerHTML = '';
            listEl.appendChild(createEmptyState());
        } else {
            listEl.innerHTML = locations.map(loc => createLocationCardHtml(loc)).join('');
        }

        // Mobile sheet
        if (isMobile) renderMobileSheet();
    }

    function createLocationCardHtml(loc) {
        const freqLabel = lang === 'ar' ? FREQ_LABELS[loc.frequency].ar : FREQ_LABELS[loc.frequency].en;
        return '<div class="location-card" onclick="focusLocation(\'' + loc.id + '\')">' +
            '<div class="location-card-icon" style="background: ' + loc.color + '20; color: ' + loc.color + '">' + loc.icon + '</div>' +
            '<div class="location-card-info"><div class="location-card-name">' + loc.name + '</div>' +
            '<div class="location-card-meta"><span class="location-card-freq" style="background: ' + loc.color + '20; color: ' + loc.color + '">' + freqLabel + '</span></div></div>' +
            '<button class="location-card-delete" onclick="event.stopPropagation(); removeLocation(\'' + loc.id + '\')">âœ•</button></div>';
    }

    function createEmptyState() {
        const div = document.createElement('div');
        div.className = 'empty-state';
        div.innerHTML = '<div class="empty-state-icon empty-state-animated">ğŸ“</div>' +
            '<p>' + (lang === 'ar' ? 'Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ù…Ø§ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©' : 'Search or click on the map to add your frequent places') + '</p>' +
            '<div class="empty-state-dots"><span></span><span></span><span></span></div>';
        return div;
    }

    function focusLocation(id) {
        const loc = locations.find(l => l.id === id);
        if (loc) { map.flyTo([loc.lat, loc.lng], 15, { duration: 0.8 }); loc.marker.openPopup(); }
    }

    function updateCalculateButton() {
        const btn = document.getElementById('calculateBtn');
        if (btn) btn.disabled = locations.length < 2;
        const sheetBtn = document.getElementById('sheetCalcBtn');
        if (sheetBtn) sheetBtn.disabled = locations.length < 2;
    }

    // ===== CONFETTI =====
    function launchConfetti() {
        const container = document.getElementById('confettiContainer');
        container.innerHTML = '';
        const colors = ['#10b981', '#6ee7b7', '#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6', '#ec4899', '#fff'];
        for (let i = 0; i < 60; i++) {
            const piece = document.createElement('div');
            piece.className = 'confetti-piece';
            piece.style.left = Math.random() * 100 + '%';
            piece.style.background = colors[Math.floor(Math.random() * colors.length)];
            piece.style.animationDelay = Math.random() * 1.5 + 's';
            piece.style.animationDuration = (2 + Math.random() * 2) + 's';
            const shapes = ['50%', '0'];
            piece.style.borderRadius = shapes[Math.floor(Math.random() * shapes.length)];
            piece.style.width = (6 + Math.random() * 8) + 'px';
            piece.style.height = (6 + Math.random() * 8) + 'px';
            container.appendChild(piece);
        }
        setTimeout(() => { container.innerHTML = ''; }, 4000);
    }

    // ===== CALCULATE =====
    async function calculateOptimal() {
        if (locations.length < 2) return;

        const btn = document.getElementById('calculateBtn');
        if (btn) {
            btn.classList.add('loading');
            btn.innerHTML = '<span>â³</span> <span>' + (lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...' : 'Calculating...') + '</span>';
        }
        const sheetBtn = document.getElementById('sheetCalcBtn');
        if (sheetBtn) { sheetBtn.disabled = true; sheetBtn.textContent = lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...' : 'Calculating...'; }

        clearResult();
        await new Promise(r => setTimeout(r, 500));

        let totalW = 0, wLat = 0, wLng = 0;
        locations.forEach(loc => {
            const w = FREQ_WEIGHTS[loc.frequency];
            wLat += loc.lat * w; wLng += loc.lng * w; totalW += w;
        });
        const cLat = wLat / totalW;
        const cLng = wLng / totalW;

        centroidMarker = L.marker([cLat, cLng], {
            icon: L.divIcon({
                className: 'custom-marker',
                html: '<div class="centroid-marker-inner"></div>',
                iconSize: [22, 22], iconAnchor: [11, 11]
            }), zIndexOffset: 1000
        }).addTo(map);

        const latOff = 0.5 / 111.32;
        const lngOff = 0.5 / (111.32 * Math.cos(cLat * Math.PI / 180));
        zoneRect = L.rectangle([
            [cLat - latOff, cLng - lngOff], [cLat + latOff, cLng + lngOff]
        ], { color: '#10b981', weight: 2, fillColor: '#10b981', fillOpacity: 0.12, dashArray: '8, 6' }).addTo(map);

        const distData = locations.map(loc => {
            const dist = haversineDistance(cLat, cLng, loc.lat, loc.lng);
            const normalMin = estimateMinutes(dist, AVG_SPEED_NORMAL);
            const rushMin = estimateMinutes(dist, AVG_SPEED_RUSH);
            return { loc, dist, normalMin, rushMin };
        });

        distData.forEach(({ loc, dist, normalMin, rushMin }) => {
            const line = L.polyline([[cLat, cLng], [loc.lat, loc.lng]], { color: loc.color, weight: 2, dashArray: '6, 8', opacity: 0.5 }).addTo(map);
            connectionLines.push(line);

            const dText = lang === 'ar' ? 'Ø¯' : 'min';
            const labelHtml = '<div class="marker-info-label"><div class="marker-info-km">' + dist.toFixed(1) + ' km</div>' +
                '<div class="marker-info-time">ğŸš— ' + normalMin + ' ' + dText + '</div>' +
                '<div class="marker-info-rush">ğŸ”´ ' + rushMin + ' ' + dText + '</div></div>';

            const offsetLat = (loc.lat - cLat) * 0.15;
            const offsetLng = (loc.lng - cLng) * 0.15;

            const label = L.marker([loc.lat + offsetLat, loc.lng + offsetLng], {
                icon: L.divIcon({ className: '', html: labelHtml, iconSize: [100, 50], iconAnchor: [50, 25] }),
                interactive: false
            }).addTo(map);
            distanceLabels.push(label);
        });

        const bounds = L.latLngBounds(locations.map(l => [l.lat, l.lng]));
        bounds.extend([cLat, cLng]);
        map.flyToBounds(bounds.pad(0.2), { duration: 1.2 });

        const neighborhood = await reverseGeocode(cLat, cLng);
        document.getElementById('resultNeighborhood').textContent = neighborhood;

        const avgDist = distData.reduce((s, d) => s + d.dist, 0) / distData.length;
        const avgNormal = Math.round(distData.reduce((s, d) => s + d.normalMin, 0) / distData.length);
        const avgRush = Math.round(distData.reduce((s, d) => s + d.rushMin, 0) / distData.length);

        const descText = lang === 'ar'
            ? 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø³Ø§ÙØ©: ' + avgDist.toFixed(1) + ' ÙƒÙ… Â· Ø¹Ø§Ø¯ÙŠ ~' + avgNormal + ' Ø¯ Â· Ø°Ø±ÙˆØ© ~' + avgRush + ' Ø¯'
            : 'Avg distance: ' + avgDist.toFixed(1) + ' km Â· Normal ~' + avgNormal + ' min Â· Rush ~' + avgRush + ' min';
        document.getElementById('resultDesc').textContent = descText;

        buildJustification(distData, cLat, cLng, neighborhood);

        const distHtml = distData.map(({ loc, dist, normalMin, rushMin }) => {
            const dLabel = lang === 'ar' ? 'Ø¯' : 'min';
            const normalLabel = lang === 'ar' ? 'Ø¹Ø§Ø¯ÙŠ' : 'Normal';
            const rushLabel = lang === 'ar' ? 'Ø°Ø±ÙˆØ©' : 'Rush';
            return '<div class="result-distance-item"><div class="result-distance-header">' +
                '<div class="result-distance-name"><span>' + loc.icon + '</span><span>' + loc.name + '</span></div>' +
                '<span class="result-distance-km">' + dist.toFixed(1) + ' km</span></div>' +
                '<div class="result-distance-times">' +
                '<span class="result-time-badge result-time-normal">ğŸš— ' + normalLabel + ': ' + normalMin + ' ' + dLabel + '</span>' +
                '<span class="result-time-badge result-time-rush">ğŸ”´ ' + rushLabel + ': ' + rushMin + ' ' + dLabel + '</span></div></div>';
        }).join('');

        document.getElementById('resultDistances').innerHTML = distHtml;
        document.getElementById('resultCard').classList.add('show');
        document.getElementById('howItWorks').style.display = 'none';

        const adSlot2 = document.getElementById('adSlot2');
        if (adSlot2) adSlot2.style.display = '';

        if (btn) {
            btn.classList.remove('loading');
            btn.innerHTML = '<span>âœ¨</span> <span data-ar="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ" data-en="Where should I live?">' + (lang === 'ar' ? 'ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ' : 'Where should I live?') + '</span>';
            btn.disabled = true;
        }

        isCalculated = true;
        updateProgress();

        document.getElementById('brokerSection').classList.add('show');
        document.getElementById('brokerCta').style.display = '';
        document.getElementById('brokerForm').classList.remove('show');
        document.getElementById('brokerSuccess').classList.remove('show');

        launchConfetti();
        showToast(lang === 'ar' ? 'ğŸ¯ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©!' : 'ğŸ¯ Optimal area found!');

        if (isMobile) {
            expandSheet();
            renderMobileSheet();
        } else {
            document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        if (sheetBtn) {
            sheetBtn.disabled = true;
            sheetBtn.innerHTML = '<span data-ar="ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ âœ¨" data-en="Where to live? âœ¨">' + (lang === 'ar' ? 'ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ âœ¨' : 'Where to live? âœ¨') + '</span>';
        }
    }

    // ===== JUSTIFICATION =====
    function buildJustification(distData, cLat, cLng, neighborhood) {
        const justEl = document.getElementById('resultJustification');
        const sorted = [...distData].sort((a, b) => FREQ_WEIGHTS[b.loc.frequency] - FREQ_WEIGHTS[a.loc.frequency]);
        const mostVisited = sorted[0];
        const farthest = [...distData].sort((a, b) => b.dist - a.dist)[0];
        const nearest = [...distData].sort((a, b) => a.dist - b.dist)[0];

        const totalTrips = distData.reduce((s, d) => s + FREQ_WEIGHTS[d.loc.frequency], 0);
        const totalKm = distData.reduce((s, d) => s + d.dist * FREQ_WEIGHTS[d.loc.frequency] * 2, 0);
        const totalNormalMin = Math.round(distData.reduce((s, d) => s + d.normalMin * FREQ_WEIGHTS[d.loc.frequency] * 2, 0));
        const totalRushMin = Math.round(distData.reduce((s, d) => s + d.rushMin * FREQ_WEIGHTS[d.loc.frequency] * 2, 0));
        const dailyNormal = Math.round(totalNormalMin / 30);
        const dailyRush = Math.round(totalRushMin / 30);

        let points;
        if (lang === 'ar') {
            points = [
                'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ø®ØªØ§Ø±Ø© Ù„Ø£Ù†Ù‡Ø§ Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù„Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ø£ÙƒØ«Ø± Ø²ÙŠØ§Ø±Ø© "' + mostVisited.loc.name + '" (' + FREQ_LABELS[mostVisited.loc.frequency].ar + ') Ù…Ø¹ Ù…ÙˆØ§Ø²Ù†Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†.',
                'Ø£Ù‚Ø±Ø¨ Ù…ÙƒØ§Ù†: "' + nearest.loc.name + '" (' + nearest.dist.toFixed(1) + ' ÙƒÙ…ØŒ ~' + nearest.normalMin + ' Ø¯ Ø¹Ø§Ø¯ÙŠ). Ø£Ø¨Ø¹Ø¯ Ù…ÙƒØ§Ù†: "' + farthest.loc.name + '" (' + farthest.dist.toFixed(1) + ' ÙƒÙ…ØŒ ~' + farthest.normalMin + ' Ø¯ Ø¹Ø§Ø¯ÙŠ).',
                'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø±Ø­Ù„Ø§ØªÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©: ' + totalTrips + ' Ø±Ø­Ù„Ø© Ø°Ù‡Ø§Ø¨ØŒ ~' + Math.round(totalKm) + ' ÙƒÙ…. ÙˆÙ‚Øª Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©: ~' + totalNormalMin + ' Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ø§Ø¯ÙŠ / ~' + totalRushMin + ' Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙ‚Øª Ø§Ù„Ø°Ø±ÙˆØ©.',
                'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠ: ~' + dailyNormal + ' Ø¯Ù‚ÙŠÙ‚Ø© (Ø¹Ø§Ø¯ÙŠ) / ~' + dailyRush + ' Ø¯Ù‚ÙŠÙ‚Ø© (ÙˆÙ‚Øª Ø§Ù„Ø²Ø­Ù…Ø©).'
            ];
        } else {
            points = [
                'This area is closest to your most visited place "' + mostVisited.loc.name + '" (' + FREQ_LABELS[mostVisited.loc.frequency].en + ') while balancing all locations.',
                'Nearest: "' + nearest.loc.name + '" (' + nearest.dist.toFixed(1) + ' km, ~' + nearest.normalMin + ' min). Farthest: "' + farthest.loc.name + '" (' + farthest.dist.toFixed(1) + ' km, ~' + farthest.normalMin + ' min).',
                'Monthly trips: ' + totalTrips + ' one-way, ~' + Math.round(totalKm) + ' km. Drive time: ~' + totalNormalMin + ' min normal / ~' + totalRushMin + ' min rush hour.',
                'Daily driving avg: ~' + dailyNormal + ' min (normal) / ~' + dailyRush + ' min (rush hour).'
            ];
        }

        const title = lang === 'ar' ? 'ğŸ’¡ Ù„Ù…Ø§Ø°Ø§ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŸ' : 'ğŸ’¡ Why this area?';
        justEl.innerHTML = '<div class="justification-title">' + title + '</div>' +
            '<div class="justification-text">' +
            points.map(p => '<div class="justification-point"><span>â€¢</span><span>' + p + '</span></div>').join('') +
            '</div>';
    }

    // ===== HAVERSINE =====
    function haversineDistance(lat1, lng1, lat2, lng2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLng = (lng2 - lng1) * Math.PI / 180;
        const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLng/2)**2;
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    // ===== CLEAR & RESET =====
    function clearResult() {
        if (centroidMarker) { map.removeLayer(centroidMarker); centroidMarker = null; }
        if (zoneRect) { map.removeLayer(zoneRect); zoneRect = null; }
        connectionLines.forEach(l => map.removeLayer(l)); connectionLines = [];
        distanceLabels.forEach(l => map.removeLayer(l)); distanceLabels = [];
        document.getElementById('resultCard').classList.remove('show');
        document.getElementById('brokerSection').classList.remove('show');
        document.getElementById('howItWorks').style.display = '';
        const adSlot2 = document.getElementById('adSlot2');
        if (adSlot2) adSlot2.style.display = 'none';
        isCalculated = false;
        updateCalculateButton();
        updateProgress();
    }

    function resetAll() {
        clearResult();
        locations.forEach(loc => { if (loc.marker) markersGroup.removeLayer(loc.marker); });
        locations = [];
        renderLocationsList();
        updateCalculateButton();
        updateProgress();
        document.getElementById('mapOverlay').classList.remove('hidden');
        map.flyTo([24.7136, 46.6753], 11, { duration: 1 });
        showToast(lang === 'ar' ? 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·' : 'Reset complete');
        if (isMobile) { renderMobileSheet(); collapseSheet(); }
    }

    // ===== SHARE =====
    function shareResult() {
        const neighborhood = document.getElementById('resultNeighborhood').textContent;
        let totalW = 0, wLat = 0, wLng = 0;
        locations.forEach(loc => { const w = FREQ_WEIGHTS[loc.frequency]; wLat += loc.lat*w; wLng += loc.lng*w; totalW += w; });
        const cLat = wLat/totalW, cLng = wLng/totalW;

        const lines = locations.map(loc => {
            const d = haversineDistance(cLat, cLng, loc.lat, loc.lng);
            const n = estimateMinutes(d, AVG_SPEED_NORMAL);
            const r = estimateMinutes(d, AVG_SPEED_RUSH);
            return lang === 'ar'
                ? loc.icon + ' ' + loc.name + ': ' + d.toFixed(1) + ' ÙƒÙ… (~' + n + ' Ø¯ Ø¹Ø§Ø¯ÙŠ / ~' + r + ' Ø¯ Ø°Ø±ÙˆØ©)'
                : loc.icon + ' ' + loc.name + ': ' + d.toFixed(1) + ' km (~' + n + ' min / ~' + r + ' min rush)';
        }).join('\n');

        const text = lang === 'ar'
            ? 'ğŸ  ÙˆÙŠÙ† Ø£Ø³ÙƒÙ†ØŸ\nØ§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©: ' + neighborhood + '\n\n' + lines + '\n\nğŸ“ weeenaskn.com'
            : 'ğŸ  Where to Live?\nOptimal Area: ' + neighborhood + '\n\n' + lines + '\n\nğŸ“ weeenaskn.com';

        navigator.clipboard.writeText(text).then(() => {
            showToast(lang === 'ar' ? 'ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©!' : 'ğŸ“‹ Result copied!');
        }).catch(() => showToast(lang === 'ar' ? 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø®' : 'âš ï¸ Copy failed'));
    }

    // ===== LANGUAGE =====
    function setLang(newLang) {
        lang = newLang;
        document.documentElement.lang = newLang;
        document.documentElement.dir = newLang === 'ar' ? 'rtl' : 'ltr';

        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.lang-btn')[newLang === 'ar' ? 0 : 1].classList.add('active');

        document.querySelectorAll('[data-ar]').forEach(el => {
            el.textContent = newLang === 'ar' ? el.dataset.ar : el.dataset.en;
        });
        document.querySelectorAll('[data-ar-ph]').forEach(el => {
            el.placeholder = newLang === 'ar' ? el.dataset.arPh : el.dataset.enPh;
        });

        renderLocationsList();
        locations.forEach(loc => { if (loc.marker) loc.marker.setPopupContent(createPopupContent(loc)); });
        updateProgress();
        setTimeout(() => map.invalidateSize(), 100);
    }

    // ===== TOAST =====
    let toastTimeout;
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => t.classList.remove('show'), 2500);
    }

    // ===== UTILS =====
    function escapeHtml(str) {
        const d = document.createElement('div');
        d.textContent = str;
        return d.innerHTML.replace(/'/g, "\\'");
    }

    // ===== BROKER FORM =====
    let brokerData = { propertyType: null, purpose: null };

    function showBrokerForm() {
        document.getElementById('brokerCta').style.display = 'none';
        document.getElementById('brokerForm').classList.add('show');
        document.getElementById('brokerForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function selectProperty(el) {
        document.querySelectorAll('#propertyTypes .property-type-btn').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
        brokerData.propertyType = el.dataset.type;
        checkBrokerFormValid();
    }

    function selectPurpose(el) {
        document.querySelectorAll('#purposeChips .chip').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        brokerData.purpose = el.dataset.purpose;
        checkBrokerFormValid();
    }

    function checkBrokerFormValid() {
        const phone = document.getElementById('brokerPhone').value.trim();
        const isValid = brokerData.propertyType && brokerData.purpose && phone.length >= 9 && phone.startsWith('5');
        document.getElementById('brokerSubmitBtn').disabled = !isValid;
    }

    // ===== GOOGLE SHEETS CONFIG =====
    const GOOGLE_SHEETS_URL = '';

    function submitBrokerForm() {
        const phone = document.getElementById('brokerPhone').value.trim();
        const neighborhood = document.getElementById('resultNeighborhood').textContent;

        const requestData = {
            id: 'req_' + Date.now(),
            neighborhood: neighborhood,
            propertyType: brokerData.propertyType,
            purpose: brokerData.purpose,
            budget: '',
            rooms: '',
            family: '',
            timeline: '',
            notes: '',
            phone: '+966' + phone,
            status: 'new',
            timestamp: new Date().toISOString(),
            date: new Date().toLocaleDateString('ar-SA'),
            time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })
        };

        saveLeadToLocal(requestData);
        if (GOOGLE_SHEETS_URL) sendToGoogleSheets(requestData);

        document.getElementById('brokerForm').classList.remove('show');
        document.getElementById('brokerSuccess').classList.add('show');
        document.getElementById('brokerSuccess').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        showToast(lang === 'ar' ? 'ğŸ‰ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ!' : 'ğŸ‰ Request sent!');
    }

    function saveLeadToLocal(data) {
        try {
            const leads = JSON.parse(localStorage.getItem('wainaskan_leads') || '[]');
            leads.unshift(data);
            localStorage.setItem('wainaskan_leads', JSON.stringify(leads));
        } catch (e) { console.error('Error saving lead:', e); }
    }

    function sendToGoogleSheets(data) {
        try {
            fetch(GOOGLE_SHEETS_URL, {
                method: 'POST', mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).catch(err => console.log('Sheets sync pending:', err));
        } catch (e) { console.log('Will sync later:', e); }
    }

    // ===== MOBILE BOTTOM SHEET =====
    let sheetExpanded = false;
    let sheetStartY = 0;
    let sheetCurrentY = 0;
    let sheetDragging = false;

    function expandSheet() {
        const sheet = document.getElementById('bottomSheet');
        if (!sheet) return;
        sheet.classList.remove('collapsed');
        sheet.classList.add('expanded');
        sheetExpanded = true;
    }

    function collapseSheet() {
        const sheet = document.getElementById('bottomSheet');
        if (!sheet) return;
        sheet.classList.remove('expanded');
        sheet.classList.add('collapsed');
        sheetExpanded = false;
    }

    function toggleSheet() {
        if (sheetExpanded) collapseSheet(); else expandSheet();
    }

    function setupBottomSheet() {
        const handle = document.getElementById('sheetDragHandle');
        const summary = document.getElementById('sheetSummary');
        if (!handle) return;

        const onStart = (y) => { sheetDragging = true; sheetStartY = y; };
        const onMove = (y) => {
            if (!sheetDragging) return;
            sheetCurrentY = y - sheetStartY;
        };
        const onEnd = () => {
            if (!sheetDragging) return;
            sheetDragging = false;
            if (sheetCurrentY > 50) collapseSheet();
            else if (sheetCurrentY < -50) expandSheet();
            sheetCurrentY = 0;
        };

        handle.addEventListener('touchstart', (e) => { onStart(e.touches[0].clientY); }, { passive: true });
        handle.addEventListener('touchmove', (e) => { onMove(e.touches[0].clientY); }, { passive: true });
        handle.addEventListener('touchend', onEnd);

        handle.addEventListener('click', toggleSheet);
        if (summary) summary.addEventListener('click', (e) => {
            if (e.target.tagName !== 'BUTTON') toggleSheet();
        });
    }

    function renderMobileSheet() {
        const content = document.getElementById('sheetContent');
        const countEl = document.getElementById('sheetLocCount');
        if (!content) return;

        const countText = lang === 'ar' ? locations.length + ' Ù…ÙˆØ§Ù‚Ø¹' : locations.length + ' locations';
        if (countEl) countEl.textContent = countText;

        let html = '';

        // Search
        html += '<div class="search-container" id="mobileSearchContainer">' +
            '<input type="text" class="search-input" id="mobileSearchInput" ' +
            'placeholder="' + (lang === 'ar' ? 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶...' : 'Search for a location in Riyadh...') + '" ' +
            'autocomplete="off" style="font-size:16px;">' +
            '<span class="search-icon">ğŸ”</span>' +
            '<div class="search-results" id="mobileSearchResults"></div></div>';

        // Locations
        if (locations.length > 0) {
            html += '<div><div class="locations-section-title"><span>' + (lang === 'ar' ? 'Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©' : 'Selected Locations') + '</span>' +
                '<span class="locations-count">' + locations.length + '</span></div>';
            html += '<div class="locations-list" style="margin-top:8px;">';
            html += locations.map(loc => createLocationCardHtml(loc)).join('');
            html += '</div></div>';
        }

        // Result (if calculated)
        if (isCalculated) {
            html += document.getElementById('resultCard').outerHTML.replace('id="resultCard"', 'id="mobileResultCard"').replace('display: none', 'display: block');
            html += document.getElementById('brokerSection').outerHTML.replace('id="brokerSection"', 'id="mobileBrokerSection"');
        }

        // How it works (if not calculated)
        if (!isCalculated) {
            html += document.getElementById('howItWorks').outerHTML;
        }

        content.innerHTML = html;

        // Setup mobile search
        const mobileInput = document.getElementById('mobileSearchInput');
        const mobileResults = document.getElementById('mobileSearchResults');
        if (mobileInput && mobileResults) {
            setupSearch(mobileInput, mobileResults);
        }
    }

    function renderMobileSheetWithForm() {
        const content = document.getElementById('sheetContent');
        if (!content) return;

        const formEl = document.getElementById('addForm');
        if (formEl) formEl.classList.add('show');

        let html = '<div id="mobileAddFormWrapper">' + formEl.outerHTML + '</div>';
        content.innerHTML = html;

        // Rebind events for mobile form
        const mobileForm = content.querySelector('.add-form');
        if (mobileForm) mobileForm.classList.add('show');
    }

    function renderMobileSheetSearch(query) {
        const content = document.getElementById('sheetContent');
        if (!content) return;

        let html = '<div class="search-container" id="mobileSearchContainer">' +
            '<input type="text" class="search-input" id="mobileSearchInput" value="' + query + '" ' +
            'autocomplete="off" style="font-size:16px;">' +
            '<span class="search-icon">ğŸ”</span>' +
            '<div class="search-results" id="mobileSearchResults"></div></div>';
        content.innerHTML = html;

        const mobileInput = document.getElementById('mobileSearchInput');
        const mobileResults = document.getElementById('mobileSearchResults');
        if (mobileInput && mobileResults) {
            setupSearch(mobileInput, mobileResults);
            mobileInput.dispatchEvent(new Event('input'));
            mobileInput.focus();
        }
    }

    // ===== INIT =====
    document.addEventListener('DOMContentLoaded', function() {
        initMap();

        // Desktop search setup
        const desktopInput = document.getElementById('searchInput');
        const desktopResults = document.getElementById('searchResults');
        if (desktopInput && desktopResults) {
            setupSearch(desktopInput, desktopResults);
        }

        // Broker phone validation
        const phoneEl = document.getElementById('brokerPhone');
        if (phoneEl) phoneEl.addEventListener('input', checkBrokerFormValid);

        // Bottom sheet
        setupBottomSheet();
        if (isMobile) renderMobileSheet();

        updateProgress();
    });
    </script>
</body>
</html>